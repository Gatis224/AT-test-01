<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8" />
  <title>PDF uz Excel caur n8n Proxy</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 100px auto;
      text-align: center;
      max-width: 500px;
    }
    .btn {
      background-color: #0078d7;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
      border-radius: 8px;
      transition: 0.2s;
    }
    .btn:hover {
      background-color: #005fa3;
    }
    #status {
      margin-top: 20px;
      font-style: italic;
      color: #555;
    }
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #ccc;
      border-top-color: #0078d7;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h2>Augšupielādē PDF un izvēlies n8n workflow</h2>
  <input type="file" id="pdfFile" accept="application/pdf" />
  <br />
  <button class="btn" onclick="uploadFile(1)">Nosūtīt uz n8n (1)</button>
  <button class="btn" onclick="uploadFile(2)">Nosūtīt uz n8n (2)</button>

  <div id="status"></div>

  <script>
    async function uploadFile(workflowNumber) {
      const fileInput = document.getElementById('pdfFile');
      const status = document.getElementById('status');
      if (!fileInput.files.length) {
        alert("Lūdzu izvēlies PDF failu!");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      const endpoint = workflowNumber === 1
        ? "https://at-test-01.onrender.com/upload1"
        : "https://at-test-01.onrender.com/upload2";

      status.innerHTML = `<div class="loading"></div> Nosūta uz n8n #${workflowNumber}...`;

      try {
        const response = await fetch(endpoint, { method: "POST", body: formData });

        if (!response.ok) {
          const text = await response.text();
          throw new Error("Kļūda: " + text);
        }

        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "rezultats.xlsx";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        status.innerHTML = "✅ Fails sagatavots un lejupielādēts!";

      } catch (err) {
        status.innerHTML = "❌ Kļūda: " + err.message;
      }
    }
  </script>
</body>
</html>